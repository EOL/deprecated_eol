!!!
%html{ "xml:lang" => "en", :lang => "en", :xmlns => "http://www.w3.org/1999/xhtml" }
  %head
    %meta{ :name => "verify-v1", :content => "mJIytYT6a+K1y+bCmD1wr1ge+4Q63O0YfTHCYWwkzaY=" }
    %meta{ :content => "text/html; charset=utf-8", "http-equiv" => "Content-type" }
    %meta{ :content => "en-us", "http-equiv" => "Content-Language" }
    %title
      - # Accessibility tip: Page titles should be unique and meaningful to the page and include the site name.
      - # Home page title can just be the site name.
      - page_title =  I18n.t(:encyclopedia_of_life)
      - if @page_title
        - page_title =   I18n.t(:eol_colon)+"#{@page_title} - #{page_title}"
      - elsif (@taxon_concept and not @taxon_concept.title(@session_hierarchy).blank?)
        - page_title =  I18n.t(:eol_colon)+"#{@taxon_concept.title(@session_hierarchy)} - #{page_title}"
      &= strip_tags(page_title)
    %meta{ :content => "no", "http-equiv" => "imagetoolbar" }
    %meta{ :name => "MSSmartTagsPreventParsing", :content => "true" }
    %meta{ :content => "IE=EmulateIE7", "http-equiv" => "X-UA-Compatible" }

    - if @taxon_concept
      %meta{ :name => "description", :content => h(strip_tags("#{@taxon_concept.title} (#{@taxon_concept.subtitle}) in Encyclopedia of Life")) }
      %meta{ :name => "keywords", :content => meta_keywords(h(strip_tags(@taxon_concept.title + ' ' + @taxon_concept.subtitle))) }

      - if @taxon_concept.has_feed?
        %link#content_rss{ :title => 'Latest Content', :href => url_for(:controller => :feeds, :action => :all, :id => @taxon_concept.id), :rel => "alternate", :type => "application/rss+xml"}
      - if (@taxon_concept.entry && @taxon_concept.entry.hierarchies_content && (@taxon_concept.entry.hierarchies_content.image != 0 || @taxon_concept.entry.hierarchies_content.child_image != 0))
        %link#media_rss{ :title => 'MediaRSS Feed', :href => "/content/mediarss/#{@taxon_concept.id}", :rel => "alternate", :type => "application/rss+xml" }
      - else
        %meta{ :name => "description", :content => "Encyclopedia of Life" }
        %meta{ :name => "keywords", :content => "Encyclopedia of Life,Biodiversity,Biology,Bioinformatics" }

    - if @no_cache
      %meta{ :content => "NO-CACHE", "http-equiv" => "CACHE-CONTROL" }
      %meta{ :content => "NO-CACHE", "http-equiv" => "PRAGMA" }

    %link{ :href => "/favicon.ico", :rel => "shortcut icon", :type => "image/x-icon" }
    %link{ :href => "/opensearchdescription.xml", :title => "Encyclopedia of Life", :rel => "search", :type => "application/opensearchdescription+xml" }
    = stylesheet_link_merged 'base-cached'
    = eol_lang_main_stylesheet 'buttons', :media => "all"
    = stylesheet_link_tag 'star_rating'
    = stylesheet_link_tag 'wikipedia'
    = javascript_include_merged 'base-cached'
    /[if lt IE 7]
      %style{:type => "text/css", :media => "screen"}
        body { behavior: url(/javascripts/csshover.htc); }
    = yield :head

  %body{ :id => "#{h controller.controller_name}-page" }
    %ul.hide
      %li
        %a{ :href => "#global-navigation", :title => I18n.t(:skip_to_navigation)  }
          = I18n.t(:skip_to_navigation)
      %li
        %a{ :href => "#toc", :title => I18n.t(:skip_to_table_of_contents)  }
          = I18n.t(:skip_to_table_of_contents)
      %li
        %a{ :href => "#center-page-content", :title => I18n.t(:skip_to_content)  }
          = I18n.t(:skip_to_content)
    %hr
    #container
      #header
        %h1
          %a{ :href => root_url, :title =>  I18n.t(:encyclopedia_of_life)  }
            %span
        %hr
        - cache(:controller => '/content', :part => 'top_nav_' + current_user.language_abbr) do
          %p.hide
            = I18n.t(:global_navigation)
          %ul#global-navigation
            %li
              %a{ :href => root_url, :title => I18n.t(:home)  }
                = I18n.t(:home)
            %li
              = link_to( I18n.t(:preferences) , settings_url, {:title =>  I18n.t(:preferences) , :class => 'return_to'})
            %li
              %a.dropdown{ :title => "#{ I18n.t(:language) }: #{I18n.locale}" }
                = I18n.t(:language)
                \:
                = I18n.locale
              %ul.uppercase
                - Language.find_active.each do |language|
                  %li
                    = link_to("#{language.source_form} <em>(#{language.display_code})</em>", set_language_url(:language => language.iso_639_1), :class => 'return_to', :title => language.source_form)
                %li
                  = link_to 'Google Translate', {:controller => '/content', :action => 'translate'}, {:class => 'return_to', :title => 'Google Translate'}
            %li
              %a#feedback.dropdown{ :title => I18n.t(:feedback)  }
                = I18n.t(:feedback)
              %ul.uppercase
                =# render :partial => 'layouts/top_menu_item', :locals => {:menu_items => ContentSection.find_pages_by_section('Feedback')}
            %li
              %a#press_room.dropdown{ :title => I18n.t(:press_room)  }
                =# I18n.t(:press_room)
              %ul.uppercase
                =# render :partial => 'layouts/top_menu_item', :locals => {:menu_items => ContentSection.find_pages_by_section('Press Room')}
            %li
              %a#using_the_site.dropdown{ :title => I18n.t(:using_the_site)  }
                =# I18n.t(:using_the_site)
              %ul.uppercase
                =# render :partial => 'layouts/top_menu_item', :locals => {:menu_items => ContentSection.find_pages_by_section('Using the Site')}
            %li.last
              %a#about_eol.last.dropdown{ :title => I18n.t(:about_eol)  }
                = I18n.t(:about_eol)
              %ul.uppercase
                =# render :partial => 'layouts/top_menu_item', :locals => {:menu_items => ContentSection.find_pages_by_section('About EOL')}
          %hr

        #ajax-indicator.ajax-indicator{ :style => "display:none;" }
          = image_tag('indicator_arrows_black.gif', :alt => 'loading', :title => 'loading')
        %p.hide
          = I18n.t(:personal_space)
        #personal-space
          - if @home_page
            %span.quote
              "Imagine an electronic page for each species of organism on Earth..."
            \- Edward O. Wilson
          - if logged_in? && $ALLOW_USER_LOGINS && !agent_logged_in?
            .desc-personal
              %p
                %strong
                  - if current_user.is_curator?
                    = link_to( I18n.t(:hello_user , :user => current_user.given_name) , {:controller => '/account', :action => 'show', :id => current_user.id}, {:class => 'return_to'})
                  - else
                    =  I18n.t(:hello_user , :user => current_user.given_name)

                = @home_page.nil? ? "</p><p>" : " | "
                = link_to( I18n.t(:admin) ,{:controller => '/admin',:action => 'index'}) + " | " if current_user.is_admin?
                - if current_user.is_curator?
                  = link_to("curators", {:controller => '/content', :action => 'page', :id => 'curator_central'})
                  |
                = link_to( I18n.t(:your_preferences) , {:controller => '/account', :action => 'profile'}, {:class => 'return_to'})
                |
                = link_to( I18n.t(:logout) , logout_url, {:class => 'return_to'})
          - elsif $ALLOW_USER_LOGINS && !agent_logged_in?
            %p
              = link_to( I18n.t(:login) , {:controller => '/account', :action => 'login'}, {:class => 'return_to'})
              |
              = link_to( I18n.t(:create_account) , {:controller => '/account', :action => 'signup'}, {:class => 'return_to'})
          - elsif $ALLOW_USER_LOGINS == false && @home_page.nil?
            %p
              =  I18n.t(:user_system_down)
          - elsif agent_logged_in?
            .desc-personal
              %p
                %strong
                  =  I18n.t(:hello_user , :user => current_agent.full_name)
                = @home_page.nil? ? "</p><p>" : " | "
                = link_to( I18n.t(:dashboard) ,:controller => '/content_partner',:action => 'index')
                |
                = link_to( I18n.t(:logout) , {:controller => '/content_partner',:action => 'logout'},  {:class => 'return_to'})
          %hr
        #quick-search
          = render :partial => "/layouts/search_field"

        - if @taxon_concept
          .page-mode

            - if current_user.vetted
              - current_mode= I18n.t(:authoritative_information) ;change_mode= I18n.t(:all_information) ;set_vetted="false"
            - else
              - current_mode= I18n.t(:all_information) ;change_mode= I18n.t(:authoritative_information) ;set_vetted="true"

            Showing:
            %a{ :href => "#{current_url}?vetted=#{set_vetted}", :title => "click to show #{change_mode}" }
              = current_mode
            %br
            - if (current_user.default_hierarchy_id.to_s != Hierarchy.default.id.to_s && !current_user.default_hierarchy_id.blank?)
              %a{ :href => url_for(settings_url), :title => "using #{current_user.selected_default_hierarchy}, click to change" }
                = I18n.t(:alternate_classification)
              %br
            - if current_user.filter_content_by_hierarchy
              %a{ :href => url_for(settings_url), :title => "click to change settings" }
                = I18n.t(:filtered_information)
              %br
      - # a div to wrap *just* the rendered template, so it's easy to update the whole template via Ajax calls, if needed
      #content
        = yield(:content) or yield
      #footer
        =# render :partial => 'layouts/footer_menu', :locals => {:menu_items => ContentSection.find_pages_by_section('Footer')}
        = ENV['APP_VERSION'] unless ENV['APP_VERSION'].blank?
        - if flash[:warning] || flash[:error]
          = link_to( I18n.t(:show_warning_message) , '#', :id => 'show-flash', :rel => '#flash-bad')
        - elsif flash[:notice]
          = link_to( I18n.t(:show_status_message) , '#', :id => 'show-flash', :rel => '#flash-good')
    - if flash[:notice]
      #flash-good{ :style => "display: block" }
        = flash[:notice]
        .note
          = I18n.t(:esc_key_hides_this_message)
    - elsif flash[:warning] || flash[:error]
      #flash-bad{ :style => "display: block" }
        = (flash[:warning] || '') + (flash[:error] || '')
        .note
          = I18n.t(:esc_key_hides_this_message)
    - if flash[:notice] || flash[:warning] || flash[:error]
      - flash[:notice] = flash[:warning] = flash[:error] = nil
      :javascript
        var trigger = $("a#show-flash").overlay({
          top: 165,
          mask: {
            color: '#000000',
            loadSpeed: 500,
            opacity: 0.5
          },
          closeOnClick: true
        });
        overlay = trigger.overlay();
        overlay.load();
        window.setTimeout(function() {overlay.close();}, 2000)
    - if $ENABLE_ANALYTICS || true
      :javascript
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      :javascript
        try { var pageTracker = _gat._getTracker("#{$GOOGLE_ANALYTICS_ID}"); pageTracker._trackPageview(); } catch(err) {}
