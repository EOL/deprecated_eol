/*!
 * NETEYE Activity Indicator jQuery Plugin
 *
 * Copyright (c) 2010 NETEYE GmbH
 * Licensed under the MIT license
 *
 * Author: Felix Gnass [fgnass at neteye dot de]
 * Version: @{VERSION}
 */
/**
 * Plugin that renders a customisable activity indicator (spinner) using SVG or VML.
 */
(function(e){function r(t,n){var r=document.createElementNS("http://www.w3.org/2000/svg",t||"svg");return n&&e.each(n,function(e,t){r.setAttributeNS(null,e,t)}),e(r)}e.fn.activity=function(r){return this.each(function(){var i=e(this),s=i.data("activity");s&&(clearInterval(s.data("interval")),s.remove(),i.removeData("activity"));if(r!==!1){r=e.extend({color:i.css("color")},e.fn.activity.defaults,r),s=t(i,r).css("position","absolute").prependTo(r.outside?"body":i);var o=i.outerHeight()-s.height(),u=i.outerWidth()-s.width(),a={top:r.valign=="top"?r.padding:r.valign=="bottom"?o-r.padding:Math.floor(o/2),left:r.align=="left"?r.padding:r.align=="right"?u-r.padding:Math.floor(u/2)},f=i.offset();r.outside?s.css({top:f.top+"px",left:f.left+"px"}):(a.top-=s.offset().top-f.top,a.left-=s.offset().left-f.left),s.css({marginTop:a.top+"px",marginLeft:a.left+"px"}),n(s,r.segments,Math.round(10/r.speed)/10),i.data("activity",s)}}),this},e.fn.activity.defaults={segments:12,space:3,length:7,width:4,speed:1.2,align:"center",valign:"center",padding:4},e.fn.activity.getOpacity=function(e,t){var n=e.steps||e.segments-1,r=e.opacity!==undefined?e.opacity:1/n;return 1-Math.min(t,n)*(1-r)/n};var t=function(){return e("<div>").addClass("busy")},n=function(){};if(document.createElementNS&&document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect){t=function(t,n){var i=n.width*2+n.space,s=i+n.length+Math.ceil(n.width/2)+1,o=r().width(s*2).height(s*2),u=r("g",{"stroke-width":n.width,"stroke-linecap":"round",stroke:n.color}).appendTo(r("g",{transform:"translate("+s+","+s+")"}).appendTo(o));for(var a=0;a<n.segments;a++)u.append(r("line",{x1:0,y1:i,x2:0,y2:i+n.length,transform:"rotate("+360/n.segments*a+", 0, 0)",opacity:e.fn.activity.getOpacity(n,a)}));return e("<div>").append(o).width(2*s).height(2*s)};if(document.createElement("div").style.WebkitAnimationName!==undefined){var i={};n=function(e,t,n){if(!i[t]){var r="spin"+t,s="@-webkit-keyframes "+r+" {";for(var o=0;o<t;o++){var u=Math.round(1e5/t*o)/1e3,a=Math.round(1e5/t*(o+1)-1)/1e3,f="% { -webkit-transform:rotate("+Math.round(360/t*o)+"deg); }\n";s+=u+f+a+f}s+="100% { -webkit-transform:rotate(100deg); }\n}",document.styleSheets[0].insertRule(s),i[t]=r}e.css("-webkit-animation",i[t]+" "+n+"s linear infinite")}}else n=function(e,t,n){var r=0,i=e.find("g g").get(0);e.data("interval",setInterval(function(){i.setAttributeNS(null,"transform","rotate("+ ++r%t*(360/t)+")")},n*1e3/t))}}else{var s=e("<shape>").css("behavior","url(#default#VML)");e("body").append(s);if(s.get(0).adj){var o=document.createStyleSheet();e.each(["group","shape","stroke"],function(){o.addRule(this,"behavior:url(#default#VML);")}),t=function(t,n){var r=n.width*2+n.space,i=r+n.length+Math.ceil(n.width/2)+1,s=i*2,o=-Math.ceil(s/2),u=e("<group>",{coordsize:s+" "+s,coordorigin:o+" "+o}).css({top:o,left:o,width:s,height:s});for(var a=0;a<n.segments;a++)u.append(e("<shape>",{path:"m "+r+",0  l "+(r+n.length)+",0"}).css({width:s,height:s,rotation:360/n.segments*a+"deg"}).append(e("<stroke>",{color:n.color,weight:n.width+"px",endcap:"round",opacity:e.fn.activity.getOpacity(n,a)})));return e("<group>",{coordsize:s+" "+s}).css({width:s,height:s,overflow:"hidden"}).append(u)},n=function(e,t,n){var r=0,i=e.get(0);e.data("interval",setInterval(function(){i.style.rotation=++r%t*(360/t)},n*1e3/t))}}e(s).remove()}})(jQuery);