if(!EOL){EOL={};}
if(!EOL.Curation){EOL.Curation={};}
EOL.Curation.form_is_valid=function(form){var untrusted_option_checked=$('#'+form.attr('data-data_object_id')+'_vetted_id_'+EOL.Curation.UNTRUSTED_ID).is(':checked');var comment_empty=form.find('.curation-comment-box').val()=="";var untrust_reasons_unchecked=form.find('.untrust_reason:checked').siblings().map(function(){return this.innerHTML}).get()=="";return untrusted_option_checked?!(comment_empty&&untrust_reasons_unchecked):true;}
EOL.Curation.update_icons=function(data_object_id,visibility_id){$('ul[data-data_object_id='+data_object_id+'] li.invisible_icon').hide();$('ul[data-data_object_id='+data_object_id+'] li.inappropriate_icon').hide();if(visibility_id==EOL.Curation.INVISIBLE_ID){$('ul[data-data_object_id='+data_object_id+'] li.invisible_icon').css({display:'inline-block'});}else if(visibility_id==EOL.Curation.INAPPROPRIATE_ID){$('ul[data-data_object_id='+data_object_id+'] li.inappropriate_icon').css({display:'inline-block'});}};EOL.Curation.post_curate_image=function(args,page_type){var dato_id=args[0];var visibility_id=args[1];var vetted_id=args[2];var vetted_label=EOL.Curation.vetted_type[vetted_id];if(page_type=='species_page'){EOL.Curation.update_icons(dato_id,visibility_id);EOL.toggle_main_img_icons(dato_id);thumbnail=$('#thumbnails a#thumb-'+dato_id);image_wrap=$('#image-'+dato_id);notes=$('#mc-notes-'+dato_id);classes='trusted unknown untrusted unknown-text untrusted-text trusted-text';thumbnail.removeClass(classes).addClass(vetted_label);image_wrap.removeClass(classes).addClass(vetted_label);notes.removeClass(classes).addClass(vetted_label+'-text');}else{var div_id=$('#'+dato_id+'_vetted_id_'+vetted_id);var undo_move=$('#undo-move-'+dato_id);div_id.parents('td').removeClass('unknown untrusted trusted').addClass(vetted_label);div_id.parents('td').siblings('td').removeClass('unknown untrusted trusted').addClass(vetted_label);undo_move.removeClass('unknown untrusted trusted').addClass(vetted_label);}};EOL.Curation.post_curate_text=function(args,page_type){var data_object_id=args[0];var visibility_id=args[1];var vetted_id=args[2];if(page_type=='species_page'){$('div#text_buttons_'+data_object_id+' div.trust_button').remove();$('div#text_buttons_'+data_object_id+' div.untrust_button').remove();$('#text_'+data_object_id).removeClass('untrusted unknown trusted');if(vetted_id==EOL.Curation.UNTRUSTED_ID){$('#text_'+data_object_id).addClass('untrusted');}else if(vetted_id==EOL.Curation.UNKNOWN_ID){$('#text_'+data_object_id).addClass('unknown');}
EOL.Curation.update_icons(data_object_id,visibility_id);}};$(document).ready(function(){$('form.curation_form input[type="submit"]').click(function(){var form=$(this).closest('form');var page_type=form.attr('data-page_type');form.find('div.processing').show();submit=form.find(':submit');the_comment=form.find('textarea');var reasons=form.find('.untrust_reason:checked').siblings().map(function(){return this.innerHTML}).get().join(",\n");if(reasons){reasons="Reasons to Untrust:\n\n"+reasons
form.find('.untrust_reasons_comment').attr('value',reasons);}
$.ajax({url:form.attr('action'),type:'PUT',dataType:'json',beforeSend:function(xhr){if(EOL.Curation.form_is_valid(form)){xhr.setRequestHeader("Accept","text/javascript");submit.attr('disabled','disabled');the_comment.attr('disabled','disabled');}else{form.find('.untrust_reason').parent().parent().find('b').show().css("color","red");form.find('div.processing').fadeOut();return false;}},complete:function(){submit.attr('disabled','');the_comment.attr('disabled','');form.find('div.processing').fadeOut();form.find('.untrust_reason').parent().parent().find('b').show().css("color","black");},success:function(response){$('#comment_button_link_'+response.args[0]+' .span_block').html(response.args[4]);if(form.find('.reason').siblings("input").attr("checked")||the_comment.val()){$('#comment_button_link_'+response.args[0]).click();}
form.find('.untrust_reasons_comment').attr('value','');the_comment.val('');if(response.type=="text"){EOL.Curation.post_curate_text(response.args,page_type);}else{EOL.Curation.post_curate_image(response.args,page_type);}},data:$(form).serialize()});return false;});$('div.vetted .untrust input[type="radio"]').click(function(){$(this).parent().find('.untrust_reason').parent().parent().find('b').show().css("color","black");$(this).parent().find('div.reason').slideDown();});$('div.vetted .trust input[type="radio"]').click(function(){$(this).parent().parent().find('div.reason').slideUp();});$('div.vetted .unreviewed input[type="radio"]').click(function(){$(this).parent().parent().find('div.reason').slideUp();});$('form.curation .cancel-button').click(function(){$(this).closest('div.overlay, div.text-slidebox-container').find('a.close, a.close-button').click();});$('div.text_curation_close a.close-button').click(function(){$(this).parent().parent().parent().slideUp();});});