/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
!function(){function e(e,t,i){t.is&&t.getCustomData("block_processed")||(t.is&&CKEDITOR.dom.element.setMarker(i,t,"block_processed",!0),e.push(t))}function t(t,i){function n(e){for(var t,i=new CKEDITOR.dom.elementPath(e).elements,n=0;n<i.length;n++)if(i[n].getName()in c){t=i[n];break}return t}function a(){this.foreach(function(e){/^(?!vbox|hbox)/.test(e.type)&&(e.setup||(e.setup=function(t){e.setValue(t.getAttribute(e.id)||"")}),e.commit||(e.commit=function(t){var i=this.getValue();("dir"!=e.id||t.getComputedStyle("direction")!=i)&&(i?t.setAttribute(e.id,i):t.removeAttribute(e.id))}))})}function o(t){{var i,n,a,o=[],r={},l=[],u=t.document.getSelection(),p=u.getRanges(),h=u.createBookmarks();t.config.enterMode==CKEDITOR.ENTER_DIV?"div":"p"}for(n=0;n<p.length;n++)for(a=p[n].createIterator();i=a.getNextParagraph();)if(i.getName()in c){var m,f=i.getChildren();for(m=0;m<f.count();m++)e(l,f.getItem(m),r)}else{for(;!d[i.getName()]&&"body"!=i.getName();)i=i.getParent();e(l,i,r)}CKEDITOR.dom.element.clearAllMarkers(r);var g,v,b=s(l);for(n=0;n<b.length;n++){var y=b[n][0];for(g=y.getParent(),m=1;m<b[n].length;m++)g=g.getCommonAncestor(b[n][m]);for(v=new CKEDITOR.dom.element("div",t.document),m=0;m<b[n].length;m++){for(y=b[n][m];!y.getParent().equals(g);)y=y.getParent();b[n][m]=y}for(m=0;m<b[n].length;m++)y=b[n][m],y.getCustomData&&y.getCustomData("block_processed")||(y.is&&CKEDITOR.dom.element.setMarker(r,y,"block_processed",!0),m||v.insertBefore(y),v.append(y));CKEDITOR.dom.element.clearAllMarkers(r),o.push(v)}return u.selectBookmarks(h),o}function r(e){var t=new CKEDITOR.dom.elementPath(e.getSelection().getStartElement()),i=t.blockLimit,n=i&&i.getAscendant("div",!0);return n}function s(e){for(var t,i=[],a=null,o=0;o<e.length;o++){t=e[o];var r=n(t);r.equals(a)||(a=r,i.push([])),i[i.length-1].push(t)}return i}function l(e){var i=this.getDialog(),n=i._element&&i._element.clone()||new CKEDITOR.dom.element("div",t.document);this.commit(n,!0),e=[].concat(e);for(var a,o=e.length,r=0;o>r;r++)a=i.getContentElement.apply(i,e[r].split(":")),a&&a.setup&&a.setup(n,!0)}var c=function(){var e=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);return delete e.div,t.config.div_wrapTable&&(delete e.td,delete e.th),e}(),d=CKEDITOR.dtd.div,u={},p=[];return{title:t.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:t.lang.common.generalTab,title:t.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:t.lang.div.styleSelectLabel,"default":"",items:[[t.lang.common.notSet,""]],onChange:function(){l.call(this,["info:class","advanced:dir","advanced:style"])},setup:function(e){for(var t in u)u[t].checkElementRemovable(e,!0)&&this.setValue(t)},commit:function(e){var t;if(t=this.getValue()){var i=u[t],n=e.getCustomData("elementStyle")||"";i.applyToObject(e),e.setCustomData("elementStyle",n+i._.definition.attributes.style)}}},{id:"class",type:"text",label:t.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:t.lang.common.advancedTab,title:t.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",label:t.lang.common.id,"default":""},{type:"text",id:"lang",label:t.lang.link.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",style:"width: 100%;",label:t.lang.common.cssStyle,"default":"",commit:function(e){var t=this.getValue()+(e.getCustomData("elementStyle")||"");e.setAttribute("style",t)}}]},{type:"hbox",children:[{type:"text",id:"title",style:"width: 100%;",label:t.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",style:"width: 100%;",label:t.lang.common.langDir,"default":"",items:[[t.lang.common.notSet,""],[t.lang.common.langDirLtr,"ltr"],[t.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){a.call(this);var e=this,i=this.getContentElement("info","elementStyle");t.getStylesSet(function(t){var n;if(t)for(var a=0;a<t.length;a++){var o=t[a];o.element&&"div"==o.element&&(n=o.name,u[n]=new CKEDITOR.style(o),i.items.push([n,n]),i.add(n,n))}i[i.items.length>1?"enable":"disable"](),setTimeout(function(){i.setup(e._element)},0)})},onShow:function(){if("editdiv"==i){var e=r(t);e&&this.setupContent(this._element=e)}},onOk:function(){p="editdiv"==i?[this._element]:o(t,!0);for(var e=p.length,n=0;e>n;n++)this.commitContent(p[n]),!p[n].getAttribute("style")&&p[n].removeAttribute("style");this.hide()},onHide:function(){"editdiv"==i&&this._element.removeCustomData("elementStyle"),delete this._element}}}CKEDITOR.dialog.add("creatediv",function(e){return t(e,"creatediv")}),CKEDITOR.dialog.add("editdiv",function(e){return t(e,"editdiv")})}();