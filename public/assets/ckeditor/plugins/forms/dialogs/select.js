/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.dialog.add("select",function(e){function t(e,t,i,n,a){e=c(e);var o;return o=n?n.createElement("OPTION"):document.createElement("OPTION"),e&&o&&"option"==o.getName()?(CKEDITOR.env.ie?(isNaN(parseInt(a,10))?e.$.options.add(o.$):e.$.options.add(o.$,a),o.$.innerHTML=t.length>0?t:"",o.$.value=i):(null!==a&&a<e.getChildCount()?e.getChild(0>a?0:a).insertBeforeMe(o):e.append(o),o.setText(t.length>0?t:""),o.setValue(i)),o):!1}function i(e){e=c(e);for(var t=r(e),i=e.getChildren().count()-1;i>=0;i--)e.getChild(i).$.selected&&e.getChild(i).remove();s(e,t)}function n(e,t,i,n){if(e=c(e),0>t)return!1;var a=e.getChild(t);return a.setText(i),a.setValue(n),a}function a(e){for(e=c(e);e.getChild(0)&&e.getChild(0).remove(););}function o(e,i,n){e=c(e);var a=r(e);if(0>a)return!1;var o=a+i;if(o=0>o?0:o,o=o>=e.getChildCount()?e.getChildCount()-1:o,a==o)return!1;var l=e.getChild(a),d=l.getText(),u=l.getValue();return l.remove(),l=t(e,d,u,n?n:null,o),s(e,o),l}function r(e){return e=c(e),e?e.$.selectedIndex:-1}function s(e,t){if(e=c(e),0>t)return null;var i=e.getChildren().count();return e.$.selectedIndex=t>=i?i-1:t,e}function l(e){return e=c(e),e?e.getChildren():!1}function c(e){return e&&e.domId&&e.getInputElement().$?e.getInputElement():e&&e.$?e:!1}return{title:e.lang.select.title,minWidth:CKEDITOR.env.ie?460:395,minHeight:CKEDITOR.env.ie?320:300,onShow:function(){var e=this;delete e.selectBox,e.setupContent("clear");var t=e.getParentEditor().getSelection().getSelectedElement();if(t&&"select"==t.getName()){e.selectBox=t,e.setupContent(t.getName(),t);for(var i=l(t),n=0;n<i.count();n++)e.setupContent("option",i.getItem(n))}},onOk:function(){var e=this.getParentEditor(),t=this.selectBox,i=!t;if(i&&(t=e.document.createElement("select")),this.commitContent(t),i&&(e.insertElement(t),CKEDITOR.env.ie)){var n=e.getSelection(),a=n.createBookmarks();setTimeout(function(){n.selectBookmarks(a)},0)}},contents:[{id:"info",label:e.lang.select.selectInfo,title:e.lang.select.selectInfo,accessKey:"",elements:[{id:"txtName",type:"text",widths:["25%","75%"],labelLayout:"horizontal",label:e.lang.common.name,"default":"",accessKey:"N",style:"width:350px",setup:function(e,t){"clear"==e?this.setValue(this["default"]||""):"select"==e&&this.setValue(t.data("cke-saved-name")||t.getAttribute("name")||"")},commit:function(e){this.getValue()?e.data("cke-saved-name",this.getValue()):(e.data("cke-saved-name",!1),e.removeAttribute("name"))}},{id:"txtValue",type:"text",widths:["25%","75%"],labelLayout:"horizontal",label:e.lang.select.value,style:"width:350px","default":"",className:"cke_disabled",onLoad:function(){this.getInputElement().setAttribute("readOnly",!0)},setup:function(e,t){"clear"==e?this.setValue(""):"option"==e&&t.getAttribute("selected")&&this.setValue(t.$.value)}},{type:"hbox",widths:["175px","170px"],children:[{id:"txtSize",type:"text",labelLayout:"horizontal",label:e.lang.select.size,"default":"",accessKey:"S",style:"width:175px",validate:function(){var t=CKEDITOR.dialog.validate.integer(e.lang.common.validateNumberFailed);return""===this.getValue()||t.apply(this)},setup:function(e,t){"select"==e&&this.setValue(t.getAttribute("size")||""),CKEDITOR.env.webkit&&this.getInputElement().setStyle("width","86px")},commit:function(e){this.getValue()?e.setAttribute("size",this.getValue()):e.removeAttribute("size")}},{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(e.lang.select.lines)+"</span>"}]},{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(e.lang.select.opAvail)+"</span>"},{type:"hbox",widths:["115px","115px","100px"],children:[{type:"vbox",children:[{id:"txtOptName",type:"text",label:e.lang.select.opText,style:"width:115px",setup:function(e){"clear"==e&&this.setValue("")}},{type:"select",id:"cmbName",label:"",title:"",size:5,style:"width:115px;height:75px",items:[],onChange:function(){var e=this.getDialog(),t=e.getContentElement("info","cmbValue"),i=e.getContentElement("info","txtOptName"),n=e.getContentElement("info","txtOptValue"),a=r(this);s(t,a),i.setValue(this.getValue()),n.setValue(t.getValue())},setup:function(e,i){"clear"==e?a(this):"option"==e&&t(this,i.getText(),i.getText(),this.getDialog().getParentEditor().document)},commit:function(e){var i=this.getDialog(),n=l(this),o=l(i.getContentElement("info","cmbValue")),r=i.getContentElement("info","txtValue").getValue();a(e);for(var s=0;s<n.count();s++){var c=t(e,n.getItem(s).getValue(),o.getItem(s).getValue(),i.getParentEditor().document);o.getItem(s).getValue()==r&&(c.setAttribute("selected","selected"),c.selected=!0)}}}]},{type:"vbox",children:[{id:"txtOptValue",type:"text",label:e.lang.select.opValue,style:"width:115px",setup:function(e){"clear"==e&&this.setValue("")}},{type:"select",id:"cmbValue",label:"",size:5,style:"width:115px;height:75px",items:[],onChange:function(){var e=this.getDialog(),t=e.getContentElement("info","cmbName"),i=e.getContentElement("info","txtOptName"),n=e.getContentElement("info","txtOptValue"),a=r(this);s(t,a),i.setValue(t.getValue()),n.setValue(this.getValue())},setup:function(e,i){var n=this;if("clear"==e)a(n);else if("option"==e){var o=i.getValue();t(n,o,o,n.getDialog().getParentEditor().document),"selected"==i.getAttribute("selected")&&n.getDialog().getContentElement("info","txtValue").setValue(o)}}}]},{type:"vbox",padding:5,children:[{type:"button",id:"btnAdd",style:"",label:e.lang.select.btnAdd,title:e.lang.select.btnAdd,style:"width:100%;",onClick:function(){var e=this.getDialog(),i=(e.getParentEditor(),e.getContentElement("info","txtOptName")),n=e.getContentElement("info","txtOptValue"),a=e.getContentElement("info","cmbName"),o=e.getContentElement("info","cmbValue");t(a,i.getValue(),i.getValue(),e.getParentEditor().document),t(o,n.getValue(),n.getValue(),e.getParentEditor().document),i.setValue(""),n.setValue("")}},{type:"button",id:"btnModify",label:e.lang.select.btnModify,title:e.lang.select.btnModify,style:"width:100%;",onClick:function(){var e=this.getDialog(),t=e.getContentElement("info","txtOptName"),i=e.getContentElement("info","txtOptValue"),a=e.getContentElement("info","cmbName"),o=e.getContentElement("info","cmbValue"),s=r(a);s>=0&&(n(a,s,t.getValue(),t.getValue()),n(o,s,i.getValue(),i.getValue()))}},{type:"button",id:"btnUp",style:"width:100%;",label:e.lang.select.btnUp,title:e.lang.select.btnUp,onClick:function(){var e=this.getDialog(),t=e.getContentElement("info","cmbName"),i=e.getContentElement("info","cmbValue");o(t,-1,e.getParentEditor().document),o(i,-1,e.getParentEditor().document)}},{type:"button",id:"btnDown",style:"width:100%;",label:e.lang.select.btnDown,title:e.lang.select.btnDown,onClick:function(){var e=this.getDialog(),t=e.getContentElement("info","cmbName"),i=e.getContentElement("info","cmbValue");o(t,1,e.getParentEditor().document),o(i,1,e.getParentEditor().document)}}]}]},{type:"hbox",widths:["40%","20%","40%"],children:[{type:"button",id:"btnSetValue",label:e.lang.select.btnSetValue,title:e.lang.select.btnSetValue,onClick:function(){var e=this.getDialog(),t=e.getContentElement("info","cmbValue"),i=e.getContentElement("info","txtValue");i.setValue(t.getValue())}},{type:"button",id:"btnDelete",label:e.lang.select.btnDelete,title:e.lang.select.btnDelete,onClick:function(){var e=this.getDialog(),t=e.getContentElement("info","cmbName"),n=e.getContentElement("info","cmbValue"),a=e.getContentElement("info","txtOptName"),o=e.getContentElement("info","txtOptValue");i(t),i(n),a.setValue(""),o.setValue("")}},{id:"chkMulti",type:"checkbox",label:e.lang.select.chkMulti,"default":"",accessKey:"M",value:"checked",setup:function(e,t){"select"==e&&this.setValue(t.getAttribute("multiple")),CKEDITOR.env.webkit&&this.getElement().getParent().setStyle("vertical-align","middle")},commit:function(e){this.getValue()?e.setAttribute("multiple",this.getValue()):e.removeAttribute("multiple")}}]}]}]}});